## 一.  分页存储管理
### 1.基本思想
	用户程序的地址空间被划分成若干固定大小的区域，称为“页”，相应地，内存空间分成若干个物理块，页和块的大小相等。可将用户程序的任一页放在内存的任一块中，实现了离散分配。
#### 1) 等分内存
	页式存储管理将内存空间划分成等长的若干物理块，成为物理页面也成为物理块，每个物理块的大小一般取2的整数幂。内存的所有物理块从0开始编号，称作物理页号。
#### 2) 逻辑地址
	系统将程序的逻辑空间按照同样大小也划分成若干页面，称为逻辑页面也称为页。程序的各个逻辑页面从0开始依次编号，称作逻辑页号或相对页号。每个页面内从0开始编址，称为页内地址。程序中的逻辑地址由两部分组成：页号P和页内位移量W。
	在执行一个程序之前，内存管理器需要的准备工作：
		1) 确定程序的页数
		2) 在主存中留出足够的空闲页面
		3) 将程序的所有页面载入主存里。（静态的分页，页面无需连续）
### 2.分页存储管理的地址机构
![[Pasted image 20211030095617.png]]

	页号x位，每个作业最多2的x次方页，页内位移量的位数表示页的大小，若页内位移量y位，则2的y次方，即页的大小，页内地址从000000000000开始到2的y次方
	
	若给定一个逻辑地址为A，页面大小为L，则
	页号P=INT[A/L]，页内地址W=A  MOD  L
### 3．内存分配
    相邻的页面在内存中不一定相邻，即分配给程序的内存块之间不一定连续。对程序地址空间的分页是系统自动进行的，即对用户是透明的。由于页面尺寸为2的整数次幂，故相对地址中的高位部分即为页号，低位部分为页内地址。
### 4.页表
![[Pasted image 20211030095639.png]]

	分页系统中，允许将进程的每一页离散地存储在内存的任一物理块中，为了能在内存中找到每个页面对应的物理块，系统为每个进程建立一张页表，用于记录进程逻辑页面与内存物理页面之间的对应关系。页表的作用是实现从页号到物理块号的地址映射，地址空间有多少页，该页表里就登记多少行，且按逻辑页的顺序排列，形如：
### 5.地址变换
![[Pasted image 20211030095653.png]]

	页式虚拟存储系统的逻辑地址是由页号和页内地址两部分组成，地址变换过程如图7-3所示。假定页面的大小为4K，图7-3中所示的十进制逻辑地址8203经过地址变换后，形成的物理地址a应为十进制。         
	
	页号： 8203/4096 = 2；页内偏移：8203%4096= 11；物理地址：物理块号*页面大小+ 页内偏移= 28683。
### 6. 具有快表的地址变换机构
	分页系统中，CPU每次要存取一个数据，都要两次访问内存（访问页表、访问实际物理地址）。为提高地址变换速度，增设一个具有并行查询能力的特殊高速缓冲存储器，称为“联想存储器”或“快表”，存放当前访问的页表项。
### 7.页面的共享与保护
    当多个不同进程中需要有相同页面信息时，可以在主存中只保留一个副本，只要让这些进程各自的有关项中指向内存同一块号即可。同时在页表中设置相应的“存取权限”，对不同进程的访问权限进行各种必要的限制。
## 二．分段存储管理
### 1.基本思想
	页面是主存物理空间中划分出来的等长的固定区域。分页方式的优点是页长固定，因而便于构造页表、易于管理，且不存在外碎片。但分页方式的缺点是页长与程序的逻辑大小不相关。例如，某个时刻一个子程序可能有一部分在主存中，另一部分则在辅存中。这不利于编程时的独立性，并给换入换出处理、存储保护和存储共享等操作造成麻烦。
	
	另一种划分可寻址的存储空间的方法称为分段。段是按照程序的自然分界划分的长度可以动态改变的区域。通常，程序员把子程序、操作数和常数等不同类型的数据划分到不同的段中，并且每个程序可以有多个相同类型的段。
	
 	段表本身也是一个段，可以存在辅存中，但一般是驻留在主存中。
	
	将用户程序地址空间分成若干个大小不等的段，每段可以定义一组相对完整的逻辑信息。存储分配时，以段为单位，段与段在内存中可以不相邻接，也实现了离散分配。
### 2.分段地址结构
	作业的地址空间被划分为若干个段，每个段定义了一组逻辑信息。例程序段、数据段等。每个段都从0开始编址，并采用一段连续的地址空间。段的长度由相应的逻辑信息组的长度决定，因而各段长度不等。整个作业的地址空间是二维的。
	
	在段式虚拟存储系统中，虚拟地址由段号和段内地址组成，虚拟地址到实存地址的变换通过段表来实现。每个程序设置一个段表，段表的每一个表项对应一个段，每个表项至少包括三个字段：有效位（指明该段是否已经调入主存）、段起址(该段在实存中的首地址)和段长（记录该段的实际长度）。
### 3.地址变换
![[Pasted image 20211030095753.png]]

	针对每一个虚拟地址，存储管理部件首先以段号S为索引访问段表的第S个表项。若该表项的有效位为1，则将虚拟地址的段内地址D与该表项的段长字段比较；若段内地址较大则说明地址越界，将产生地址越界中断；否则，将该表项的段起址与段内地址相加，求得主存实地址并访存。如果该表项的有效位为0，则产生缺页中断，从辅存中调入该页，并修改段表。段式虚拟存储器虚实地址变换过程如图所示。
	
	绝对地址=根据段号找到段表中的起始地址+段内地址 (如果段内地址超过限长则产生“地址越界”程序性中断事件达到存储保护)
### 4.分段存储方式的优缺点
	分页对程序员而言是不可见的，而分段通常对程序员而言是可见的，因而分段为组织程序和数据提供了方便。与页式虚拟存储器相比，段式虚拟存储器有许多优点：
	(1)段的逻辑独立性使其易于编译、管理、修改和保护，也便于多道程序共享。
	(2)段长可以根据需要动态改变，允许自由调度，以便有效利用主存空间。
	(3)方便编程，分段共享，分段保护，动态链接，动态增长
	
	 因为段的长度不固定，段式虚拟存储器也有一些缺点：
	(1)主存空间分配比较麻烦。
	(2)容易在段间留下许多碎片，造成存储空间利用率降低。
	(3)由于段长不一定是2的整数次幂，因而不能简单地像分页方式那样用虚拟地址和实存地址的最低若干二进制位作为段内地址，并与段号进行直接拼接，必须用加法操作通过段起址与段内地址的求和运算得到物理地址。因此，段式存储管理比页式存储管理方式需要更多的硬件支持。
## 三．段页式存储
### 1.段页式存储管理的基本思想
	段页式存储组织是分段式和分页式结合的存储组织方法，这样可充分利用分段管理和分页管理的优点。
`(1) 用分段方法来分配和管理虚拟存储器。程序的地址空间按逻辑单位分成基本独立的段，而每一段有自己的段名，再把每段分成固定大小的若干页。
(2) 用分页方法来分配和管理实存。即把整个主存分成与上述页大小相等的存储块，可装入作业的任何一页。程序对内存的调入或调出是按页进行的。但它又可按段实现共享和保护。`
	 地址空间图
	 ![[Pasted image 20211030095826.png]]
  `(3)逻辑地址结构。一个逻辑地址用三个参数表示：段号S；页号P；页内地址d。`
	  逻辑地址结构
	  ![[Pasted image 20211030095845.png]]
`（4）段表、页表、段表地址寄存器。为了进行地址转换，系统为每个作业建立一个段表，并且要为该作业段表中的每一个段建立一个页表。系统中有一个段表地址寄存器来指出作业的段表起始地址和段表长度。`
	![[Pasted image 20211030095901.png]]
### 2.地址变换过程
#### 1) 慢速地址转换过程
	一个逻辑地址为：基地址x、段号s、页号p和页内地址d，求物理地址(((x)+s)+p)*2^(11)+d
	
![[Pasted image 20211030101217.png]]

	在段页式系统中，为了便于实现地址变换，须配置一个段表寄存器，其中存放段表始址和段表长TL。
	1) 进行地址变换时，首先利用段号S，将它与段表长TL进行比较。若S<TL，表示未越界
	2) 于是利用段表始址和段号来求出该段所对应的段表项在段表中的位置，从中得到该段的页表始址
	3) 利用逻辑地址中的段内页号P来获得对应页的页表项位置，从中读出该页所在的物理块号b
	4) 再利用块号b和页内地址来构成物理地址。
	上图示出了段页式系统中的地址变换机构。在段页式系统中，为了获得一条指令或数据，须三次访问内存。第一次访问是访问内存中的段表，从中取得页表始址；第二次访问是访问内存中的页表，从中取出该页所在的物理块号，并将该块号与页内地址一起形成指令或数据的物理地址；第三次访问才是真正从第二次访问所得的地址中，取出指令或数据。
	显然，这使访问内存的次数增加了近两倍。为了提高执行速度，在地址变换机构中增设一个高速缓冲寄存器。每次访问它时，都须同时利用段号和页号去检索高速缓存，若找到匹配的表项，便可从中得到相应页的物理块号，用来与页内地址一起形成物理地址；若未找到匹配表项，则仍须再三次访问内存。
 ### 3.段页式存储管理的优缺点
	 优点
	(1) 它提供了大量的虚拟存储空间。
	(2) 能有效地利用主存，为组织多道程序运行提供了方便。
	缺点：
	(1) 增加了硬件成本、系统的复杂性和管理上的开消。
	(2) 存在着系统发生抖动的危险。
	(3) 存在着内碎片。
	(4) 还有各种表格要占用主存空间。
	 段页式存储管理技术对当前的大、中型计算机系统来说，算是最通用、最灵活的一种方案。
